<head>
    <style>
        #playground {
            width:800px;
            height: 800px;
            border-right: 2px solid white;
            border-top: 2px solid white;
        }
        
        #menu {
            width:400px;
            height: 40px;
            border-right: 2px solid white;
            border-top: 2px solid white;
        }
        
        .square{
            border-left:1px solid white;
            border-bottom:1px solid white;
                width:5%;
                height:5%;
            display: inline-block;
            box-sizing: border-box;
            background: #ecf0f1;
        }
        .square-content{
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
        
        .square-content:hover {
            background: #bdc3c7;
        }
        
        .square-content.player {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('player.png');
        }
        
        .square-content.zombie {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('zombie.png');
        }
        .square.building {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('building.png');
        }
        .square.road {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('road.png');
        }
        
        .square.sewer {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('sewer.png');
        }
        
        .square-content.fence {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('fence.png');
        }
        
        .square-content.tree {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('tree.png');
        }
        .square-content.car {
            background-size: cover;
            image-rendering: pixelated;
            background-image: url('car.png');
        }
        
        
        #menu button {
            
            width:5%;
            height:40px;
            display: inline-block;
            box-sizing: border-box;
            background: #ecf0f1;
            border: none;
            border-left:2px solid white;
            border-bottom:2px solid white;
            border-radius: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="playground"></div>
    <div id="menu">
        <button></button>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
        <button></button>
    </div>
    <script>
       
        var squares = [];
        function clicked(e){
            
                
            if(e.target.classList.value.indexOf('zombie') > -1){
                e.target.classList = "square-content";
            } else if(e.target.classList.value.indexOf('player') > -1){
                e.target.classList = "square-content zombie";
            } else if(e.target.classList.value.indexOf('fence') > -1){
                e.target.classList = "square-content player";
            }
            else {
                e.target.classList = "square-content fence";
            }
            
            
        }
        
        function check_building(x,y){
            var e = document.querySelector('[x="'+x+'"][y="'+y+'"]');
            if(e){
                return e.classList.value.indexOf('building') > -1;
            }
            
            return false;
        }
        
        function available_square(x,y){
            var e = document.querySelector('[x="'+x+'"][y="'+y+'"]');
            if(e){
                //console.log( e.classList.value.indexOf('building') == -1 && e.childNodes[0].classList.value.indexOf('car') > -1 /*&& e.childNodes[0].classList.value.indexOf('tree') > -1&& e.childNodes[0].classList.value.indexOf('player') > -1 && e.childNodes[0].classList.value.indexOf('zombie') > -1*/);
                return !(e.classList.value.indexOf('building') > -1 || e.childNodes[0].classList.value.indexOf('car') > -1 || e.childNodes[0].classList.value.indexOf('tree') > -1 || e.childNodes[0].classList.value.indexOf('player') > -1 || e.childNodes[0].classList.value.indexOf('zombie') > -1);
            }
        }
        
        function generate_playground() {
            for(var y=0; y < 20 ; y++){
                for(var x=0; x < 20 ; x++){
                    var e = document.createElement('div');
                    var e_content = document.createElement('div');
                    e.classList="square";
                    e_content.classList="square-content";
                    e.setAttribute('x',x);
                    e.setAttribute('y',y);
                    e.addEventListener('click', clicked);
                     e.classList = 'square road' ;
                    document.getElementById('playground').appendChild(e);
                    e.appendChild(e_content);
                    
                    var rand = Math.random() * 100;
                    var probability_building = check_building(x,y-1) ? 30 : 5
                    if(rand < probability_building){
                        e.classList = 'square building' ;
                    } else if(rand < (probability_building + 2)){
                        e.classList = 'square sewer' ;
                    } else {
                        e.classList = 'square road' ;
                    }
                    squares.push(e);
                }
            }
            
            squares.forEach(function(s, id){
                
                    var x= parseInt(s.getAttribute('x'));
                    var y= parseInt(s.getAttribute('y'));
                    var e = document.querySelector('[x="'+x+'"][y="'+y+'"]');
                    if(e){
                        if( !check_building(x,y) && (check_building(x-1,y) || check_building(x-1,y-1) || check_building(x+1,y+1) || check_building(x-1,y+1) || check_building(x+1,y-1) || check_building(x+1,y) || check_building(x,y-1) || check_building(x,y+1))){

                            e.classList = 'square';
                            var rand = Math.random() * 100;
                            if(rand < 5){
                                e.childNodes[0].classList = "square-content tree";
                            }
                        } else if( !check_building(x,y)) {
                            var rand = Math.random() * 100;
                            if(rand < 1){
                                e.childNodes[0].classList = "square-content car";
                            } else if(rand < 8){
                                e.childNodes[0].classList = "square-content player";
                            }
                        }
                    }
              
            });
        }
        
        function loop(){
            //calculate squares risk
            //TO DO
            
            //calculate next movement
           squares.forEach(function(s, id){
                var x= parseInt(s.getAttribute('x'));
                var y= parseInt(s.getAttribute('y'));
                var e = document.querySelector('[x="'+x+'"][y="'+y+'"]');
                if(e){
                    if(e.childNodes[0].classList.value.indexOf('player')>-1){
                        var right = document.querySelector('[x="'+(x+1)+'"][y="'+y+'"]');
                        var left = document.querySelector('[x="'+(x-1)+'"][y="'+y+'"]');
                        var up = document.querySelector('[x="'+x+'"][y="'+(y-1)+'"]');
                        var down = document.querySelector('[x="'+x+'"][y="'+(y+1)+'"]');
                        var rand = Math.random() * 100;
                        if(right && rand < 25 && available_square(x+1,y)){
                            e.setAttribute('vx',1);
                        } else if(left && rand < 50 && available_square(x-1,y)){
                            e.setAttribute('vx',-1);
                        } else if(up && rand < 75 && available_square(x,y-1)){
                            e.setAttribute('vy',-1);
                        } else if(down && rand < 100 && available_square(x,y+1)){
                            e.setAttribute('vy',1);
                        } 
                    }
                }
            });
            
            //Do movement
            squares.forEach(function(s, id){
                var x= parseInt(s.getAttribute('x'));
                var y= parseInt(s.getAttribute('y'));
                var e = document.querySelector('[x="'+x+'"][y="'+y+'"]');
                if(e){
                    if(e.getAttribute('vx') == "1"){
                        var right = document.querySelector('[x="'+(x+1)+'"][y="'+y+'"]');
                        if(right){
                            e.childNodes[0].classList = "square-content";
                            right.childNodes[0].classList = "square-content player";
                        }
                    } else if(e.getAttribute('vx') == "-1"){
                        var left = document.querySelector('[x="'+(x-1)+'"][y="'+y+'"]');
                        if(left){
                            e.childNodes[0].classList = "square-content";
                            left.childNodes[0].classList = "square-content player";
                        }
                    } else if(e.getAttribute('vy') == "1"){
                        var down = document.querySelector('[x="'+x+'"][y="'+(y+1)+'"]');
                        if(down){
                            e.childNodes[0].classList = "square-content";
                            down.childNodes[0].classList = "square-content player";
                        }
                    } else if(e.getAttribute('vy') == "-1"){
                        var up = document.querySelector('[x="'+x+'"][y="'+(y-1)+'"]');
                        if(up){
                            e.childNodes[0].classList = "square-content";
                            up.childNodes[0].classList = "square-content player";
                        }
                    }
                    e.setAttribute('vx',0);
                    e.setAttribute('vy',0);
                }
                
                
            });
        }
        
        generate_playground();
        setInterval(function(){loop();},1000);
    </script>
</body>